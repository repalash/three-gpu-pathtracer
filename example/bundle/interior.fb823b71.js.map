{"mappings":"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","sources":["example/interior.js"],"sourcesContent":["import * as THREE from 'three';\nimport { FullScreenQuad } from 'three/examples/jsm/postprocessing/Pass.js';\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader.js';\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';\nimport { PathTracingRenderer, PhysicalPathTracingMaterial } from '../src/index.js';\nimport { PathTracingSceneWorker } from '../src/workers/PathTracingSceneWorker.js';\nimport { RGBELoader } from 'three/examples/jsm/loaders/RGBELoader.js';\nimport { MeshoptDecoder } from 'three/examples/jsm/libs/meshopt_decoder.module.js';\nimport { GUI } from 'three/examples/jsm/libs/lil-gui.module.min.js';\n\nlet renderer, controls, sceneInfo, ptRenderer, camera, fsQuad;\nlet samplesEl;\nconst params = {\n\n\tenvironmentIntensity: 0,\n\tenvironmentRotation: 0,\n\temissiveIntensity: 100,\n\tbounces: 20,\n\tsamplesPerFrame: 1,\n\tresolutionScale: 1 / window.devicePixelRatio,\n\tfilterGlossyFactor: 0.25,\n\ttiles: 2,\n\n\n};\n\nif ( window.location.hash.includes( 'transmission' ) ) {\n\n\tparams.material1.metalness = 0.0;\n\tparams.material1.roughness = 0.05;\n\tparams.material1.transmission = 1.0;\n\tparams.material1.color = '#ffffff';\n\tparams.bounces = 10;\n\n}\n\n// clamp value for mobile\nconst aspectRatio = window.innerWidth / window.innerHeight;\nif ( aspectRatio < 0.65 ) {\n\n\tparams.bounces = Math.min( params.bounces, 10 );\n\tparams.resolutionScale *= 0.5;\n\tparams.tiles = 3;\n\n}\n\ninit();\n\nasync function init() {\n\n\trenderer = new THREE.WebGLRenderer( { antialias: true } );\n\trenderer.toneMapping = THREE.ACESFilmicToneMapping;\n\tdocument.body.appendChild( renderer.domElement );\n\n\tcamera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.025, 500 );\n\tcamera.position.set( 0.4, 0.6, 2.65 );\n\n\tptRenderer = new PathTracingRenderer( renderer );\n\tptRenderer.camera = camera;\n\tptRenderer.material = new PhysicalPathTracingMaterial();\n\tptRenderer.tiles.set( params.tiles, params.tiles );\n\n\tfsQuad = new FullScreenQuad( new THREE.MeshBasicMaterial( {\n\t\tmap: ptRenderer.target.texture,\n\t} ) );\n\n\tcontrols = new OrbitControls( camera, renderer.domElement );\n\tcontrols.target.set( - 0.15, 0.33, - 0.08 );\n\tcamera.lookAt( controls.target );\n\tcontrols.addEventListener( 'change', () => {\n\n\t\tptRenderer.reset();\n\n\t} );\n\tcontrols.update();\n\n\tsamplesEl = document.getElementById( 'samples' );\n\n\tconst envMapPromise = new Promise( resolve => {\n\n\t\tnew RGBELoader()\n\t\t\t.load( 'https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/equirectangular/royal_esplanade_1k.hdr', texture => {\n\n\t\t\t\tconst pmremGenerator = new THREE.PMREMGenerator( renderer );\n\t\t\t\tpmremGenerator.compileCubemapShader();\n\n\t\t\t\tconst envMap = pmremGenerator.fromEquirectangular( texture );\n\n\t\t\t\tptRenderer.material.environmentMap = envMap.texture;\n\t\t\t\tresolve();\n\n\t\t\t} );\n\n\t} );\n\n\tconst generator = new PathTracingSceneWorker();\n\tconst gltfPromise = new GLTFLoader()\n\t\t.setMeshoptDecoder( MeshoptDecoder )\n\t\t.loadAsync( 'https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/models/pathtracing-bathroom/modernbathroom.glb' )\n\t\t.then( gltf => {\n\n\t\t\tconst group = new THREE.Group();\n\t\t\tgroup.add( gltf.scene );\n\n\t\t\tconst box = new THREE.Box3();\n\t\t\tbox.setFromObject( gltf.scene );\n\n\t\t\tgroup.updateMatrixWorld();\n\n\t\t\tconst center = new THREE.Vector3();\n\t\t\tbox.getCenter( center );\n\n\t\t\tgltf.scene.position.addScaledVector( center, - 0.5 );\n\t\t\tgroup.updateMatrixWorld();\n\n\t\t\treturn generator.generate( group );\n\n\t\t} )\n\t\t.then( result => {\n\n\t\t\tsceneInfo = result;\n\n\t\t\tconst { bvh, textures, materials } = result;\n\t\t\tconst geometry = bvh.geometry;\n\t\t\tconst material = ptRenderer.material;\n\n\t\t\tmaterial.bvh.updateFrom( bvh );\n\t\t\tmaterial.normalAttribute.updateFrom( geometry.attributes.normal );\n\t\t\tmaterial.tangentAttribute.updateFrom( geometry.attributes.tangent );\n\t\t\tmaterial.uvAttribute.updateFrom( geometry.attributes.uv );\n\t\t\tmaterial.materialIndexAttribute.updateFrom( geometry.attributes.materialIndex );\n\t\t\tmaterial.textures.setTextures( renderer, 2048, 2048, textures );\n\t\t\tmaterial.materials.updateFrom( materials, textures );\n\t\t\tmaterial.setDefine( 'MATERIAL_LENGTH', materials.length );\n\n\t\t\tgenerator.dispose();\n\n\t\t} );\n\n\tawait Promise.all( [ gltfPromise, envMapPromise ] );\n\n\twindow.CAMERA = camera;\n\twindow.CONTROLS = controls;\n\n\tdocument.getElementById( 'loading' ).remove();\n\n\tonResize();\n\twindow.addEventListener( 'resize', onResize );\n\n\tconst gui = new GUI();\n\tgui.add( params, 'tiles', 1, 4, 1 ).onChange( value => {\n\n\t\tptRenderer.tiles.set( value, value );\n\n\t} );\n\tgui.add( params, 'samplesPerFrame', 1, 10, 1 );\n\tgui.add( params, 'filterGlossyFactor', 0, 1 ).onChange( () => {\n\n\t\tptRenderer.reset();\n\n\t} );\n\tgui.add( params, 'environmentIntensity', 0, 25 ).onChange( () => {\n\n\t\tptRenderer.reset();\n\n\t} );\n\tgui.add( params, 'environmentRotation', 0, 40 ).onChange( v => {\n\n\t\tptRenderer.material.environmentRotation.setFromMatrix4( new THREE.Matrix4().makeRotationY( v ) );\n\t\tptRenderer.reset();\n\n\t} );\n\tgui.add( params, 'emissiveIntensity', 0, 300 ).onChange( updateIntensity );\n\tgui.add( params, 'bounces', 1, 30, 1 ).onChange( () => {\n\n\t\tptRenderer.reset();\n\n\t} );\n\tgui.add( params, 'resolutionScale', 0.1, 1 ).onChange( () => {\n\n\t\tonResize();\n\n\t} );\n\n\tupdateIntensity();\n\n\tanimate();\n\n}\n\nfunction onResize() {\n\n\tconst w = window.innerWidth;\n\tconst h = window.innerHeight;\n\tconst scale = params.resolutionScale;\n\tconst dpr = window.devicePixelRatio;\n\n\tptRenderer.target.setSize( w * scale * dpr, h * scale * dpr );\n\tptRenderer.reset();\n\n\trenderer.setSize( w, h );\n\trenderer.setPixelRatio( window.devicePixelRatio * scale );\n\tcamera.aspect = w / h;\n\tcamera.updateProjectionMatrix();\n\n}\n\nfunction updateIntensity() {\n\n\tsceneInfo.materials.forEach( material => {\n\n\t\tmaterial.emissiveIntensity = params.emissiveIntensity;\n\n\t} );\n\tptRenderer.reset();\n\n}\n\nfunction animate() {\n\n\trequestAnimationFrame( animate );\n\n\tptRenderer.material.materials.updateFrom( sceneInfo.materials, sceneInfo.textures );\n\n\tptRenderer.material.filterGlossyFactor = params.filterGlossyFactor;\n\tptRenderer.material.environmentIntensity = params.environmentIntensity;\n\tptRenderer.material.environmentBlur = 0.35;\n\tptRenderer.material.bounces = params.bounces;\n\n\tcamera.updateMatrixWorld();\n\n\tfor ( let i = 0, l = params.samplesPerFrame; i < l; i ++ ) {\n\n\t\tptRenderer.update();\n\n\t}\n\n\trenderer.autoClear = false;\n\tfsQuad.render( renderer );\n\trenderer.autoClear = true;\n\n\tsamplesEl.innerText = `Samples: ${ Math.floor( ptRenderer.samples ) }`;\n\n}\n\n\n\n\n"],"names":["$ilwiq","parcelRequire","$0d847323f1f8b53b$var$renderer","$0d847323f1f8b53b$var$controls","$0d847323f1f8b53b$var$sceneInfo","$0d847323f1f8b53b$var$ptRenderer","$0d847323f1f8b53b$var$camera","$0d847323f1f8b53b$var$fsQuad","$0d847323f1f8b53b$var$samplesEl","$0d847323f1f8b53b$var$params","environmentIntensity","environmentRotation","emissiveIntensity","bounces","samplesPerFrame","resolutionScale","window","devicePixelRatio","filterGlossyFactor","tiles","location","hash","includes","material1","metalness","roughness","transmission","color","$0d847323f1f8b53b$var$onResize","w","innerWidth","h","innerHeight","scale","dpr","target","setSize","reset","setPixelRatio","aspect","updateProjectionMatrix","$0d847323f1f8b53b$var$updateIntensity","materials","forEach","material","$0d847323f1f8b53b$var$animate","requestAnimationFrame","updateFrom","textures","environmentBlur","updateMatrixWorld","i","l","update","autoClear","render","innerText","Math","floor","samples","min","async","WebGLRenderer","antialias","toneMapping","ACESFilmicToneMapping","document","body","appendChild","domElement","PerspectiveCamera","position","set","$4CEV9","PathTracingRenderer","camera","PhysicalPathTracingMaterial","$RPVlj","FullScreenQuad","MeshBasicMaterial","map","texture","$5Rd1x","OrbitControls","lookAt","addEventListener","getElementById","envMapPromise","Promise","resolve","$891vQ","RGBELoader","load","pmremGenerator","PMREMGenerator","compileCubemapShader","envMap","fromEquirectangular","environmentMap","generator","$cVdfP","PathTracingSceneWorker","gltfPromise","$7lx9d","GLTFLoader","setMeshoptDecoder","$kp7Te","MeshoptDecoder","loadAsync","then","gltf","group","Group","add","scene","box","Box3","setFromObject","center","Vector3","getCenter","addScaledVector","generate","result","bvh","geometry","normalAttribute","attributes","normal","tangentAttribute","tangent","uvAttribute","uv","materialIndexAttribute","materialIndex","setTextures","setDefine","length","dispose","all","CAMERA","CONTROLS","remove","gui","$jiuw3","GUI","onChange","value","v","setFromMatrix4","Matrix4","makeRotationY","$0d847323f1f8b53b$var$init"],"version":3,"file":"interior.fb823b71.js.map"}